# urdf-exporter-js
Utility for exporting THREE.js object trees as a URDF file

## URDFExporter
```js
// Function callback for defining the attributes for
// the joint to be generated for the associated link.
// If not provided, `fixed` joint type is used.
function jointFunc (obj, childName, parentName) {
  if (obj.urdf) {
      return {
          name: obj.name + 'joint',
          type: obj.urdf.type,
          limits: {
              lower: obj.urdf.min,
              lower: obj.urdf.max,
          }
      };
  }
  return {};
}

// Generate the URDF file and associate meshes and textures
const res = URDFExporter.parse(robot, 'T12', jointFunc);

// Save out a zip using JSZip (https://stuk.github.io/jszip/)
// with the file structure

// /<name>.urdf
// /meshes/<mesh>.<ext>
// /textures/<texture>.<ext>
const zip = new JSZip();
zip.file('T12.URDF', res.urdf);

const meshes = zip.folder('meshes');
res.meshes.forEach(m => meshes.file(`${m.name}.${m.ext}`, m.data));

const textures = zip.folder('images');
res.textures.forEach(m => textures.file(`${m.name}.${m.ext}`, m.data));

zip
    .generateAsync({ type: 'uint8array' })
    .then(zipdata => saveData(zipdata, 't12urdf.zip'));
```

### API
#### URDFExporter.parse(object, robotname, jointfunc, meshfunc, packageprefix, collapse)

Processes the given `object` into a URDF file and assets. Returns an object of the form
```js
{
  urdf: <string>,
  meshes: [{ name, ext, data }, ...],
  textures: [{ name, ext, data }, ...]
}
```

##### object
_required_

The THREE.js OBject3D to convert to a URDF file and associated meshes and textures.

##### robotname
_required_

The name of the robot to add into the `<robot>` tag `name` field.

##### jointfunc
_required_

A function used to define the attributes for a joint connecting a link to its parent link. Takes the object being converted to a link, the child link name and parent link name. An example with the full set of output data:

```js
function joinfunc(object, childLinkName, parentLinkName) {
  return {
  
    name: `${parentLinkName}2${childLinkName}`, // defaults to '_joint_<number>'
    
    type: `revolute`,                 // defaults to 'fixed'
    
    axis: new THREE.Vector3(1, 0, 0), // required for non-fixed joints
    
    limits: {
      lower: -30,  // optional
      upper: 30,   // optional
      velocity: 1, // defaults to 0
      effort: 1,   // defaults to 0
    }
  }
}
```

##### meshfunc
_optional_

A function used to generate mesh data for a given node. STL files are generated by default. An example function with the full set of output data:
```js
function meshFunc(obj, linkName) {
  return {
      name: linkName,
      ext: 'ply',
      data: new THREE.PLYExporter().parse(obj)
  }
}
```

##### packageprefix
_optional_

The prefix to prepend to all file paths. Defaults to `package://`.

##### collapse
_optional_

Attempts to collapse unnecessary joints to remove any meaningless links in the URDF (identity transform, fixed). Experimental. Defaults to false.
